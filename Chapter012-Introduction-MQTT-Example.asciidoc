[[ch_introduction_mqtt_example]]
=== +Motions+ Application Using MQTT

TODO

. In <<ch_mobile_mqtt>>, we will write the +Motions+ iOS application using the MQTT protocol to send data about the device motions and receive alerts.
. In <<ch_web_mqtt>>, we will write a Web application using MQTT protocol over Web Sockets to receive all the device motions data and display them. The Web application will also be able to send alert messages to any devices sending its motions data.

[[img_mqtt_example_app_1]]
.The +Motions+ application with two clients, +AAA+ and +BBB+ and two Web applications monitoring them.
image::images/Chapter012/mqtt_app_diagram_1.png["Diagram of the +Motions+ application"]

[[ch_introduction_mqtt_example_topology]]
==== Motions Messaging Topology

Each device will be associated to two destinations:

* a topic to broadcast its motion data: +/mwm/XXX/motion+ where +XXX+ is the device identifier
* a topic to receive alert message : +/mwm/XXX/alert+

Each device running the +Motions+ application will be:

* a _producer_ of messages to the topic +/mwm/XXX/motion+
* a _consumer_ of messages from the topic +/mwm/XXX/alert+

Conversely, the Web application will be:

* a _consumer_ of messages from all the topics +/mwm/XXX/motion+
* a _producer_ of message from the queues +/mwm/XXX/alert+

TODO

[[ch_introduction_mqtt_example_message]]
==== Motions Message Representation

[[ex_example_motion_data]]
.Device motion data representation
====
----
<< 1.6 -0.1 0.8 >> <1>
----
<1> The message is composed of three 64-bit float
====

[[ex_example_alert_data]]
.Alert representation
====
----
"red" <1>
----
<1> The message is composed of a string containing the name of a simple color. 
====

[[img_mqtt_example_app_2]]
.The +Motions+ application with two clients, +AAA+ and +BBB+ and two Web applications monitoring them.
image::images/Chapter012/mqtt_app_diagram_2.png["Diagram of the +Motions+ application"]

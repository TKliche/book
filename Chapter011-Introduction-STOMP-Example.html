<section data-type="sect2" id="ch_introduction_stomp_example">
<h2><code>Locations</code> Application Using STOMP</h2>

<p>Suppose that we work for a delivery company that uses a fleet of trucks to deliver packages to its clients.</p>

<p>Each truck is responsible for the delivery of packages and they receive orders from their headquarters. To efficiently manage all the trucks, the company headquarter want to monitor the truck&#8217;s positions and be able to send them orders on-the-go.</p>

<p>We will build a very simple application named <code>Locations</code> that looks similar to this example.</p>

<p>The "truck" will use an iOS application to broadcast the device&#8217;s geolocation data using its GPS sensor and display text messages that it receives from the headquarters. The "headquarter" will use a Web application to display the locations of all the "trucks" on a map. It will also be used to send text messages to a given truck on their devices:</p>
<ol>
<li>
<p>In <a data-type="xref" href="#ch_mobile_stomp"/>, we will write the <code>Locations</code> iOS application using the STOMP protocol to send GPS data and receive text from an iOS device.</p>
</li>
<li>
<p>In <a data-type="xref" href="#ch_web_stomp"/>, we will write the Web application using STOMP protocol over Web Sockets to receive GPS data in a Web browser and send text to the devices.</p>
</li>

</ol>

<figure id="img_example_app_1">
<img src="images/Chapter011/stomp_app_diagram_1.png" alt="Diagram of the Locations application with two devices, AAA and BBB, and two web applications"/>
<figcaption>Diagram of the <code>Locations</code> application with two devices, <code>AAA</code> and <code>BBB</code>, and two web applications.</figcaption>
</figure>

<p>Before introducing STOMP, the messaging protocol that will be used by the application, we can already define the application&#8217;s messaging models and how the different parts of the application will exchange messages.</p>










<section data-type="sect3" id="ch_introduction_stomp_example_topology">
<h3><code>Locations</code> Messaging Models</h3>

<p>In this application, we will use two destinations, one with a Publish/Subscribe model to broadcast the device GPS data and one with a Point-to-Point model for the text messages:</p>
<ul>
<li>
<p><code>device.XXX.location</code> is the <em>topic</em> to broadcast its GPS geolocation data where <code>XXX</code> is the device identifier (Publish/Subscribe model)</p>
</li>
<li>
<p><code>device.XXX.text</code> is the <em>queue</em> to receive simple text message  (Point-to-Point model)</p>
</li>
</ul>

<p>A topic is used to send the GPS data as this allows potentially many consumers to receive the information.
However a queue is used to handle the device&#8217;s text as only one single device will consume messages from this destination.</p>

<p>Each device (identified by an unique identifier <code>XXX</code>) running the <code>Locations</code> application will be:</p>
<ul>
<li>
<p>a <em>producer</em> of messages to the topic <code>device.XXX.location</code></p>
</li>
<li>
<p>the only <em>consumer</em> of messages from the queue <code>device.XXX.text</code></p>
</li>
</ul>

<p>Conversely, the Web application will be:</p>
<ul>
<li>
<p>a <em>consumer</em> of messages from <em>all</em> the topics of the form <code>device.XXX.location</code></p>
</li>
<li>
<p>a <em>producer</em> of message to <em>all</em> the queues of the form <code>device.XXX.text</code></p>
</li>
</ul>
</section>













<section data-type="sect3" id="ch_introduction_stomp_example_message">
<h3><code>Locations</code> Message Representation</h3>

<p>There will be two types of exchanged messages:</p>
<ul>
<li>
<p>one to represent GPS data (exhanged on the topics <code>device.XXX.location</code>)</p>
</li>
<li>
<p>one to represent orders (exchanged on the queues <code>device.XXX.text</code>)</p>
</li>
</ul>

<p>The <code>Locations</code> iOS application will send the GPS data using a JSON representation in the message payload:</p>
<div id="ex_example_gps_data" data-type="example">
<h5>Geolocation Message Payload</h5>


<pre data-type="programlisting">{
  "deviceID": "BBB",<b>(1)</b>
  "lat": 48.8581,<b>(2)</b>
  "lng": 2.2946,<b>(3)</b>
  "ts": "2013-09-23T08:43Z"<b>(4)</b>
}</pre>

<ol class="calloutlist">
<li><p>&#x278a; <code>deviceID</code> is the identifier of the device that sends its position</p>
</li>
<li><p>&#x278b; <code>lat</code> is a number representing the position&#8217;s <em>latitude</em></p>
</li>
<li><p>&#x278c; <code>lng</code> is a number representing the position&#8217;s <em>longitude</em></p>
</li>
<li><p>&#x278d; <code>ts</code> is a string representing the time when the position was taken (using the <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format)</p>
</li>

</ol></div>

<p>The text messages that will be consumed by the <code>Locations</code> iOS application will
be represented as a simple plain text string.</p>
<div id="ex_example_text" data-type="example">
<h5>Text Message Payload</h5>


<pre data-type="programlisting">"Where are you heading to?"</pre>
</div>

<p>A more realistic representation of this message would also contain additional information such the identifier of the headquarter sending the message, etc.
We are using a plain text version as this format is enough to provide a first version.</p>

<p>With the messaging topology and data representation known, we can now refine the <code>Locations</code> application diagram.</p>

<figure id="img_example_app_2">
<img src="images/Chapter011/stomp_app_diagram_2.png" alt="Diagram of the Locations application"/>
<figcaption>Diagram of the <code>Locations</code> application with its messaging models and representations</figcaption>
</figure>
</section>



</section>